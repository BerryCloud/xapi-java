# DEPRECATED: This workflow is kept for backward compatibility only
# 
# Please use the automated release process instead:
# 1. Create a new release in GitHub UI with tag format vX.Y.Z
# 2. The "Automated Release" workflow will handle the rest
#
# This workflow will build a Java project with Maven, and cache/restore any dependencies to improve the workflow execution time
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-java-with-maven

name: Maven Release (Manual - Deprecated)

on: workflow_dispatch
jobs:
  publish:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      - name: Set up JDK 17
        uses: actions/setup-java@v5
        with:
          java-version: "17"
          distribution: "temurin"
          cache: maven
          server-id: central
          server-username: MAVEN_USERNAME
          server-password: MAVEN_PASSWORD
          gpg-private-key: ${{ secrets.MAVEN_GPG_PRIVATE_KEY }}
          gpg-passphrase: MAVEN_GPG_PASSPHRASE
      - name: Publish package
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          # Only release production modules, exclude all sample modules
          # Pass -pl/-am to forked Maven invocations via -Darguments
          mvn -B -batch-mode release:prepare release:perform --file pom.xml \
            -Darguments="-pl xapi-model,xapi-client,xapi-model-spring-boot-starter -am"
        env:
          MAVEN_USERNAME: ${{ secrets.OSSRH_USERNAME }}
          MAVEN_PASSWORD: ${{ secrets.OSSRH_TOKEN }}
          MAVEN_GPG_PASSPHRASE: ${{ secrets.MAVEN_GPG_PASSPHRASE }}
